---
title: "Figures - Performance examples"
author: "Pablo Morala"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

####################################
# 1 - Load all needed packages and functions
####################################
library(nn2poly)
library(nn2poly.tools)
library(keras)
library(tensorflow)
library(cowplot)
library(ggplot2)
library(patchwork)

IEEE_width_inches <- 3.5
my_width <- IEEE_width_inches

my_seed <- 42
set.seed(my_seed)
tensorflow::tf$random$set_seed(my_seed) # Needed to have reproducible results with keras
```


In this Rmd file we are going to plot the figures from the simulations included in `Data - Performance examples.Rmd` to show how to use NN2Poly in 2 different situations with synthetically generated data.

# Example 1 - Performance

```{r}
example1 <- readRDS("nn_example_softplus_500000")
```

```{r}

plot.example <- cowplot::plot_grid(example1$plot_NN_performance, example1$plot_PR_vs_NN + ggplot2::labs(x = "Predicted Y with polynomial"), labels = c("A", "B"), scale = 0.9, label_size = 10)

plot.example


setEPS()
postscript("temporal/fig_performance_l1.eps", width = 2*my_width, height = 1*my_width)
plot.example
dev.off()

# Save as pdf as to avoid problems in arxiv
pdf(file="temporal/fig_performance_l1.pdf", width = 2*my_width, height = 1*my_width)
plot.example
dev.off()


```




# Example 2 - Performance

```{r}
example2 <- readRDS("temporal/nn_performance_example_nc")
```

```{r}

plot.example <- cowplot::plot_grid(example2$plot_NN_performance, example2$plot_PR_vs_NN + ggplot2::labs(x = "Predicted Y with polynomial"), labels = c("A", "B"), scale = 0.9, label_size = 10)

plot.example

setEPS()
postscript("temporal/fig_performance_nc.eps", width = 2*my_width, height = 1*my_width)
plot.example
dev.off()

# Save as pdf as to avoid problems in arxiv
pdf(file="temporal/fig_performance_nc.pdf", width = 2*my_width, height = 1*my_width)
plot.example
dev.off()


```


# Taylor layers

```{r}
p1 <- example1$plot_taylor[[1]] + ggtitle('Layer 1') + theme(plot.title = element_text(size = 12, face = "plain"))
p2 <- example1$plot_taylor[[2]] + ggtitle('Layer 2') + theme(plot.title = element_text(size = 12, face = "plain"))
p3 <- example1$plot_taylor[[3]] + ggtitle('Layer 3') + theme(plot.title = element_text(size = 12, face = "plain"))

p4 <- example2$plot_taylor[[1]] + ggtitle('Layer 1') + theme(plot.title = element_text(size = 12, face = "plain"))
p5 <- example2$plot_taylor[[2]] + ggtitle('Layer 2') + theme(plot.title = element_text(size = 12, face = "plain"))
p6 <- example2$plot_taylor[[3]] + ggtitle('Layer 3') + theme(plot.title = element_text(size = 12, face = "plain"))
```

```{r}
plot_taylor_final <- ( p1 / p2 / p3) | (p4 / p5 / p6 )

plot_taylor_final
```




```{r}

setEPS()
postscript("temporal/fig_taylor_layers.eps", width = 4*my_width, height =2*my_width)
plot_taylor_final
dev.off()

# Save as pdf as to avoid problems in arxiv
pdf(file="temporal/fig_taylor_layers.pdf", width = 4*my_width, height = 2*my_width)
plot_taylor_final
dev.off()

```


